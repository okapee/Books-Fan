# プロモーションコードに関する重要な注意事項

## 大文字小文字の区別

**重要**: Stripeのプロモーションコードは**大文字小文字を区別します**。

### 例
- Stripeダッシュボードで作成したコード: `BooksFanCoupon`
- ユーザーが入力すべきコード: `BooksFanCoupon`（完全一致）
- ❌ 間違い: `booksfancoupon`, `BOOKSFANCOUPON`, `Booksfancoupon`

### 推奨事項
ユーザーの入力ミスを防ぐため、プロモーションコードは以下のいずれかにすることを推奨：
1. **全て大文字**: `BOOKSFANCOUPON` - ユーザーが入力しやすい
2. **全て小文字**: `booksfancoupon` - ユーザーが入力しやすい
3. **数字とハイフン**: `3MONTHS-FREE` - わかりやすい

現在のコード `BooksFanCoupon` は大文字小文字が混在しているため、入力ミスが発生しやすいです。

## 100%割引クーポンの表示について

### Stripeチェックアウト画面での表示

100%割引（3ヶ月無料）のクーポンを適用した場合、Stripeのチェックアウト画面では以下のように表示されます：

#### パターン1: 即座に割引が表示される
```
小計: ¥980
割引 (BOOKSFANCOUPON): -¥980
今日期日の合計額: ¥0
```

#### パターン2: サブスクリプション詳細で表示される
```
Books Fan プレミアムプラン
¥980 /月

サブスクリプション詳細:
- 最初の3ヶ月: ¥0/月（100%割引）
- 4ヶ月目以降: ¥980/月
```

### なぜ ¥980 と表示されることがあるか

以下の理由で、チェックアウト画面に ¥980 と表示されることがあります：

1. **クーポンがまだ適用されていない**
   - ユーザーがコードを入力しただけで、「適用する」ボタンを押していない
   - → 「適用する」ボタンをクリックする必要があります

2. **クーポンの設定が「複数月」の場合**
   - Stripeは通常価格を表示し、サブスクリプション詳細で割引を説明します
   - → これは正常な動作です

3. **クーポンコードが無効**
   - コードの大文字小文字が間違っている
   - コードの有効期限が切れている
   - 使用回数上限に達している
   - → Stripeダッシュボードで確認してください

## 確認方法

### 1. Stripeチェックアウト画面で確認
- プロモーションコード入力欄に `BooksFanCoupon` を入力
- 「適用する」または「Apply」ボタンをクリック
- 割引が適用されると、以下のいずれかが表示されます：
  - 「今日期日の合計額: ¥0」
  - 「3 months free trial」などのメッセージ
  - クーポン適用の緑のチェックマーク

### 2. 支払い後の確認
サブスクリプションを作成した後、Stripeダッシュボードで確認：
1. https://dashboard.stripe.com/subscriptions
2. 該当のサブスクリプションをクリック
3. 「Discount」または「割引」セクションに `BooksFanCoupon` が表示されているか
4. 最初の請求書（Invoice）が ¥0 になっているか

### 3. ユーザー側での確認
ユーザーは以下で確認できます：
- 登録完了メール（Stripeから送信）
- マイページ → プラン管理
- 次回請求日と請求額の表示

## トラブルシューティング

### 問題: コードを入力しても割引が適用されない

#### 解決策1: コードの正確性を確認
```bash
# Stripeダッシュボードで確認
https://dashboard.stripe.com/coupons

# プロモーションコード一覧
https://dashboard.stripe.com/promotion_codes

# コードが「アクティブ」になっているか確認
# 大文字小文字が正確に一致しているか確認
```

#### 解決策2: テストモードと本番モードの確認
- テスト環境（localhost）：テストモードのクーポンを使用
- 本番環境（books-fan.com）：本番モードのクーポンを使用
- モードが混在していると、クーポンが見つかりません

#### 解決策3: クーポンを再作成
大文字小文字が混在している場合は、全て大文字で再作成を推奨：
```
古いコード: BooksFanCoupon
新しいコード: BOOKSFANCOUPON
```

### 問題: 割引が1回目の請求で適用されない

**これは正常な動作の場合があります**。

Stripeの「複数月割引」は以下のように動作します：
- 1回目の請求（登録時）: ¥0
- 2回目の請求（1ヶ月後）: ¥0
- 3回目の請求（2ヶ月後）: ¥0
- 4回目の請求（3ヶ月後）: ¥980（通常料金に戻る）

確認方法：
1. Stripeダッシュボード → サブスクリプション
2. 「Schedule」または「スケジュール」タブを確認
3. 各月の請求額が正しいか確認

## ベストプラクティス

### 推奨プロモーションコード設定

```
【クーポン】
名前: 3ヶ月無料キャンペーン
割引率: 100%
期間: 3ヶ月

【プロモーションコード】
コード: 3MONTHS-FREE（全て大文字、ハイフン使用）
または: LAUNCH2026（シンプルで覚えやすい）

理由:
✅ 大文字小文字の入力ミスがない
✅ ユーザーが覚えやすい
✅ 意味が明確
```

### SNS配布時の注意

```markdown
❌ 悪い例:
「プロモーションコード: BooksFanCoupon」
→ ユーザーが booksfancoupon と入力してエラー

✅ 良い例:
「プロモーションコード: BOOKSFANCOUPON
※すべて大文字で入力してください」
→ ユーザーが正しく入力できる
```

## まとめ

1. ✅ プロモーションコードは大文字小文字を区別する
2. ✅ 推奨: 全て大文字または全て小文字のコードを使用
3. ✅ テストモードと本番モードで別々のクーポンが必要
4. ✅ 100%割引でも通常価格が表示されることがある（仕様）
5. ✅ 「適用する」ボタンを押すことを忘れずに
6. ✅ サブスクリプション作成後、Stripeダッシュボードで最終確認

疑問点があれば、Stripeダッシュボードで実際のサブスクリプションを確認するのが最も確実です。
