# Stripe プロモーションコード設定ガイド

## 3ヶ月無料クーポンの作成手順

このガイドでは、Stripeダッシュボードで3ヶ月無料のプロモーションコードを作成する方法を説明します。

---

## 前提条件

- Stripeアカウントにログインしていること
- プレミアムプランの商品とサブスクリプション価格が作成済みであること（既存の `PREMIUM_PLAN_PRICE_ID`）

---

## ステップ1: クーポンの作成

### 1.1 Stripeダッシュボードにアクセス

1. [Stripe Dashboard](https://dashboard.stripe.com/) にログイン
2. 左サイドバーから **「製品」** → **「クーポン」** をクリック
3. 右上の **「クーポンを作成」** ボタンをクリック

### 1.2 クーポンの設定

以下の設定で3ヶ月無料クーポンを作成します：

#### 基本設定

- **割引タイプ**: **「パーセント割引」** を選択
- **割引率**: **100%** を入力（完全無料）
- **名前**: `3ヶ月無料キャンペーン` （管理用の名前、ユーザーには表示されません）

#### 期間設定

- **期間**: **「複数月」** を選択
- **月数**: **3** を入力

これにより、最初の3ヶ月間は100%割引（無料）、4ヶ月目から通常料金（¥980/月）が課金されます。

#### オプション設定（任意）

- **最大償還回数**: クーポンの使用回数制限を設定（例: 100回）
- **有効期限**: クーポンの有効期限を設定（例: 2026年12月31日まで）
- **通貨**: JPY（日本円）

### 1.3 クーポンを保存

- すべての設定を確認後、**「クーポンを作成」** ボタンをクリック
- クーポンIDが自動生成されます（例: `DvrxFyza` のようなランダムな文字列）

---

## ステップ2: プロモーションコードの作成

クーポンを作成しただけでは顧客は使用できません。プロモーションコード（顧客が入力するコード文字列）を作成する必要があります。

### 2.1 プロモーションコードページにアクセス

1. 左サイドバーから **「製品」** → **「プロモーションコード」** をクリック
2. 右上の **「プロモーションコードを作成」** ボタンをクリック

### 2.2 プロモーションコードの設定

- **クーポン**: 先ほど作成した「3ヶ月無料キャンペーン」クーポンを選択
- **コード**: 顧客が入力する文字列を設定（例: `3MONTHS_FREE`）
  - 推奨: 大文字、数字、アンダースコアのみ使用
  - わかりやすく、覚えやすいコードにする
  - 例: `LAUNCH2026`, `WELCOME3MONTHS`, `FREE3M` など

#### オプション設定

- **最大償還回数**: このコードの使用回数制限（クーポンとは別に設定可能）
- **有効期限**: このコードの有効期限
- **最小金額**: このコードを使用するための最小注文金額（通常は設定不要）
- **新規顧客のみ**: チェックを入れると、既存顧客は使用できません
- **アクティブ**: チェックを入れると、コードが即座に有効になります

### 2.3 プロモーションコードを保存

- **「プロモーションコードを作成」** ボタンをクリック
- コードが作成され、顧客が使用できるようになります

---

## ステップ3: 動作確認

### 3.1 テストモードでの確認

1. Stripeダッシュボードの右上を **「テストモード」** に切り替え
2. 同じ手順でテスト用のクーポンとプロモーションコードを作成
3. アプリの `/upgrade` ページにアクセス
4. プロモーションコード入力欄にテストコードを入力
5. **「今すぐアップグレード」** をクリック
6. Stripeチェックアウトページで割引が適用されているか確認

### 3.2 確認ポイント

- ✅ プロモーションコードが自動的に適用されている
- ✅ 最初の3ヶ月間が ¥0 と表示されている
- ✅ 4ヶ月目から ¥980/月 と表示されている
- ✅ 「次回請求日」が正しく表示されている

---

## ステップ4: 本番環境での適用

### 4.1 本番モードでクーポン作成

1. Stripeダッシュボードの右上を **「本番モード」** に切り替え
2. ステップ1〜2と同じ手順で本番用のクーポンとプロモーションコードを作成
3. コード文字列は同じもの（例: `3MONTHS_FREE`）を使用可能

### 4.2 顧客への配布

プロモーションコードを以下の方法で顧客に配布できます：

- メールキャンペーン
- SNS告知
- ランディングページ
- オンボーディングメール
- カスタマーサポート経由での個別配布

---

## よくある質問

### Q1: クーポンとプロモーションコードの違いは？

- **クーポン**: 割引の内容（100%オフ、3ヶ月間など）を定義するもの
- **プロモーションコード**: クーポンを顧客が使用するための文字列（例: `3MONTHS_FREE`）

1つのクーポンに対して複数のプロモーションコードを作成できます。

### Q2: 3ヶ月後に自動で課金されますか？

はい、4ヶ月目から自動的に通常料金（¥980/月）が課金されます。顧客はいつでもサブスクリプションをキャンセルできます。

### Q3: 既存の有料ユーザーもこのコードを使えますか？

デフォルトでは使えます。新規顧客のみに制限したい場合は、プロモーションコード作成時に「新規顧客のみ」にチェックを入れてください。

### Q4: コードの使用回数を制限できますか？

はい、以下の2つのレベルで制限できます：

- **クーポンレベル**: すべてのプロモーションコードを合わせた合計使用回数
- **プロモーションコードレベル**: 特定のコードの使用回数

例えば、クーポンは無制限、特定のコード `SPECIAL100` は100回まで、といった設定が可能です。

### Q5: 既に2週間無料トライアルを使ったユーザーにも適用できますか？

はい、プロモーションコードは無料トライアルとは独立しています。トライアル使用済みのユーザーも、このコードで3ヶ月無料を利用できます。

### Q6: コードを途中で無効化できますか？

はい、Stripeダッシュボードの「プロモーションコード」ページから該当コードを選択し、「アクティブ」のチェックを外すことで即座に無効化できます。

### Q7: 割引が適用されているか確認する方法は？

Stripeダッシュボードの **「顧客」** → 対象顧客 → **「サブスクリプション」** で、適用されているクーポンと割引額を確認できます。

---

## トラブルシューティング

### 問題: プロモーションコードが見つかりません

**原因**:
- コードが正しく作成されていない
- テストモードと本番モードが混在している
- コードが無効化されている

**解決方法**:
1. Stripeダッシュボードで正しいモード（テスト/本番）を確認
2. プロモーションコード一覧でコードの存在とアクティブ状態を確認
3. コード文字列のスペルミスがないか確認（大文字小文字を区別）

### 問題: 割引が適用されない

**原因**:
- クーポンの適用対象外の商品
- 最小金額条件を満たしていない
- 使用回数上限に達している
- 有効期限が切れている

**解決方法**:
1. クーポンの設定を再確認
2. プロモーションコードの「最大償還回数」と「使用済み回数」を確認
3. 有効期限を確認

---

## サンプル設定例

### 例1: 期間限定の新規登録キャンペーン

```
【クーポン設定】
- 名前: 新規登録3ヶ月無料キャンペーン（2026年1月）
- 割引率: 100%
- 期間: 3ヶ月

【プロモーションコード設定】
- コード: LAUNCH2026
- クーポン: 新規登録3ヶ月無料キャンペーン（2026年1月）
- 新規顧客のみ: ✅ チェック
- 有効期限: 2026年1月31日
- 最大償還回数: 500回
```

### 例2: カスタマーサポート向け個別配布用

```
【クーポン設定】
- 名前: VIP顧客向け3ヶ月無料
- 割引率: 100%
- 期間: 3ヶ月

【プロモーションコード設定】
- コード: VIP3MONTHS
- クーポン: VIP顧客向け3ヶ月無料
- 新規顧客のみ: ❌ チェックなし
- 有効期限: 無期限
- 最大償還回数: 50回
```

### 例3: パートナー企業向け配布用

```
【クーポン設定】
- 名前: パートナー企業従業員向け特典
- 割引率: 100%
- 期間: 3ヶ月

【プロモーションコード設定】
- コード: PARTNER_ABC
- クーポン: パートナー企業従業員向け特典
- 新規顧客のみ: ❌ チェックなし
- 有効期限: 2026年12月31日
- 最大償還回数: 1000回
```

---

## 重要な注意事項

### ⚠️ セキュリティ

- プロモーションコードは推測されにくい文字列にすることを推奨
- 一般公開する場合は使用回数制限を必ず設定
- 必要に応じて有効期限を設定し、期限後は無効化

### 💰 ビジネス上の考慮事項

- 3ヶ月無料は大きな割引なので、予算への影響を試算してください
- 使用回数を制限し、想定外のコスト発生を防ぐ
- 4ヶ月目からの継続率を追跡し、効果を測定

### 📊 分析とトラッキング

- Stripeダッシュボードで各プロモーションコードの使用状況を確認できます
- どのコードが最も効果的か定期的に分析
- 使用されていないコードは無効化して管理を簡素化

---

## 参考リンク

- [Stripe クーポンのドキュメント](https://stripe.com/docs/billing/subscriptions/coupons)
- [Stripe プロモーションコードのドキュメント](https://stripe.com/docs/billing/subscriptions/discounts/codes)
- [Stripe API - Promotion Codes](https://stripe.com/docs/api/promotion_codes)

---

## まとめ

このガイドに従って、以下の手順で3ヶ月無料クーポンを作成できます：

1. ✅ Stripeダッシュボードでクーポンを作成（100%オフ、3ヶ月間）
2. ✅ プロモーションコードを作成（例: `3MONTHS_FREE`）
3. ✅ テストモードで動作確認
4. ✅ 本番モードで同じ設定を作成
5. ✅ 顧客にコードを配布

アプリ側はすでにプロモーションコード機能を実装済みなので、Stripe側での設定のみで即座に利用開始できます。

ご不明な点があれば、Stripeのサポートまたは開発チームにお問い合わせください。
